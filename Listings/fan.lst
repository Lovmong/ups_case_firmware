C51 COMPILER V9.60.7.0   FAN                                                               09/07/2023 17:05:02 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE FAN
OBJECT MODULE PLACED IN .\Objects\fan.obj
COMPILER INVOKED BY: G:\Keil_v5_c51v961\C51\BIN\C51.EXE src\fan.c OPTIMIZE(8,SPEED) INCDIR(.\src;.\system) PRINT(.\Listi
                    -ngs\fan.lst) TABS(2) OBJECT(.\Objects\fan.obj)

line level    source

   1          #include "fan.h"
   2          
   3          /*---------------------------------------------------------------
   4              fan: (PWMA)
   5                  FAN -> PWM3P_2 -> P2.4  
   6                  (Ê≥®ÊÑè‰∏çÊòØÈªòËÆ§ÁöÑPWMÂºïËÑöÔºåÈúÄË¶Å‰ΩøÁî® PWMA_PS ÂØÑÂ≠òÂô® ÈÄâÊã©ÂºïËÑö)
   7          ---------------------------------------------------------------*/
   8          void fanInit() {
   9   1          // P2M0 |= 0x10; P2M1 &= ~0x10;     // P2.4 Êé®ÊåΩËæìÂá∫
  10   1          P2M0 &= ~0x10; P2M1 &= ~0x10;    // P2.4 ÂáÜÂèåÂêëÂè£
  11   1          FAN = 0;
  12   1          
  13   1      #if FAN_USE_PWM
  14   1          // PWM3P P2.4
  15   1          P_SW2 |= 0x80;                              //‰ΩøËÉΩÊâ©Â±ïÂØÑÂ≠òÂô®(XFR)ËÆøÈóÆ
  16   1      
  17   1          PWMA_PS |= 0x10;                            //ËÆæÁΩÆPWM3 ËæìÂá∫ËÑö‰∏∫ P2.4, P2.5
  18   1      
  19   1          PWMA_CCER1 = 0x00;                          //ÂÜôCCMRxÂâçÂøÖÈ°ªÂÖàÊ∏ÖÈõ∂CCERxÂÖ≥Èó≠ÈÄöÈÅì
  20   1          PWMA_CCMR3 = 0x68;                          //ËÆæÁΩÆPWM3ËæìÂá∫Ê®°Âºè 1, ‰ΩøËÉΩÈ¢ÑË£ÖËΩΩÂäüËÉΩ
  21   1          PWMA_CCER2 = 0x01;                          //‰ΩøËÉΩPWM3PÈÄöÈÅì, ÊûÅÊÄß‰∏∫ È´òÁîµÂπ≥ÊúâÊïà
  22   1      
  23   1          PWMA_PSCRH = (u8)((_PWMA_PSCR-1) >> 8);     // ËÆæÁΩÆPWMAÈ¢ÑÂàÜÈ¢ë
  24   1          PWMA_PSCRL = (u8)(_PWMA_PSCR-1);
  25   1          PWMA_ARRH = (u8)((_PWMA_PERIOD-1) >> 8);    //ËÆæÁΩÆÂë®ÊúüÊó∂Èó¥Ôºå PWMA_ARRËá™Âä®ÈáçË£ÖÂÄº
  26   1          PWMA_ARRL = (u8)(_PWMA_PERIOD-1);
  27   1      
  28   1          PWMA_CCR3H = (u8)(0 >> 8);                  //ÂàùÂßãÂåñPWM3Âç†Á©∫ÊØîÊó∂Èó¥
  29   1          PWMA_CCR3L = (u8)(0);
  30   1      
  31   1          PWMA_ENO |= 0x10;                           //‰ΩøËÉΩPWM3PËæìÂá∫
  32   1      
  33   1          // PWMA_IOAUX &= ~0x10;                        // PWM3P ÁöÑËæìÂá∫Áõ¥Êé•Áî± ENO3P ÊéßÂà∂
  34   1      
  35   1          PWMA_BKR = 0x80;                            //‰ΩøËÉΩPWMA‰∏ªËæìÂá∫
  36   1          PWMA_CR1 = 0x01;                            //‰ΩøËÉΩPWMAËÆ°Êï∞Âô®ÔºåÂºÄÂßãËÆ°Êó∂, (00 ËæπÊ≤øÂØπÈΩêÊ®°Â
             -ºè)
  37   1      
  38   1      #endif
  39   1      }
  40          
  41          
  42          void fanSetSpeed(u8 speed) {
  43   1      #if FAN_USE_PWM
  44   1          u16 ccr = 0;
  45   1          ccr = ((u32)_PWMA_PERIOD * speed/100);
  46   1      
  47   1          P_SW2 |= 0x80;                              //‰ΩøËÉΩÊâ©Â±ïÂØÑÂ≠òÂô®(XFR)ËÆøÈóÆ
  48   1          PWMA_CCR3H = (u8)(ccr >> 8);                //ËÆæÁΩÆPWM3Âç†Á©∫ÊØî
  49   1          PWMA_CCR3L = (u8)(ccr);
  50   1      #else
                  if (speed == 0) FAN = 0;
                  else FAN = 1;
              #endif
C51 COMPILER V9.60.7.0   FAN                                                               09/07/2023 17:05:02 PAGE 2   

  54   1      }
  55          
  56          
  57          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    113    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
