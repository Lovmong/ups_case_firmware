C51 COMPILER V9.60.7.0   I2C                                                               09/04/2023 09:40:51 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\i2c.obj
COMPILER INVOKED BY: G:\Keil_v5_c51v961\C51\BIN\C51.EXE src\i2c.c OPTIMIZE(8,SPEED) INCDIR(.\src;.\system) PRINT(.\Listi
                    -ngs\i2c.lst) TABS(2) OBJECT(.\Objects\i2c.obj)

line level    source

   1          #include "i2c.h"
   2          
   3          void I2CInit() {
   4   1          P1M0 &= ~0x30; P1M1 &= ~0x30;  // P1.4, P1.5 准双向口
   5   1      
   6   1          P_SW2 = 0x80;
   7   1      
   8   1          I2CCFG = 0x81;                              //使能I2C从机模式
   9   1          I2CSLADR = I2C_SLAVE_ADDR;                  //设置从机设备地址寄存器I2CSLADR=0101_1010B
  10   1                                                      //即I2CSLADR[7:1]=010_1101B,MA=0B。
  11   1                                                      //由于MA为0,主机发送的的设备地址必须与
  12   1                                                      //I2CSLADR[7:1]相同才能访问此I2C从机设备。
  13   1                                                      //主机若需要写数据则要发送5AH(0101_1010B)
  14   1                                                      //主机若需要读数据则要发送5BH(0101_1011B)
  15   1          I2CSLST = 0x00;
  16   1          I2CSLCR = 0x78;                             //使能从机模式中断
  17   1          EA = 1;
  18   1      
  19   1          isda = 1;                                   //用户变量初始化
  20   1          isma = 1;
  21   1          addr = 0;
  22   1          I2CTXD = sendbuffer[0];
  23   1          I2CRXD = buffer[addr];
  24   1      
  25   1      }
  26          
  27          // void I2C_Isr() interrupt 24
  28          // {
  29          //     _push_(P_SW2);
  30          //     P_SW2 |= 0x80;
  31          
  32          //     if (I2CSLST & 0x40)
  33          //     {
  34          //         I2CSLST &= ~0x40;                       //处理START事件
  35          //     }
  36          //     else if (I2CSLST & 0x20)
  37          //     {
  38          //         I2CSLST &= ~0x20;                       //处理RECV事件
  39          //         if (isda)
  40          //         {
  41          //             isda = 0;                           //处理RECV事件（RECV DEVICE ADDR）
  42          //         }
  43          //         else if (isma)
  44          //         {
  45          //             isma = 0;                           //处理RECV事件（RECV MEMORY ADDR）
  46          //             addr = I2CRXD;
  47          //             I2CTXD = buffer[addr];
  48          //         }
  49          //         else
  50          //         {
  51          //             buffer[addr++] = I2CRXD;            //处理RECV事件（RECV DATA）
  52          //         }
  53          //     }
  54          //     else if (I2CSLST & 0x10)
C51 COMPILER V9.60.7.0   I2C                                                               09/04/2023 09:40:51 PAGE 2   

  55          //     {
  56          //         I2CSLST &= ~0x10;                       //处理SEND事件
  57          //         if (I2CSLST & 0x02)
  58          //         {
  59          //             I2CTXD = 0xff;                      //接收到NAK则停止读取数据
  60          //         }
  61          //         else
  62          //         {
  63          //             I2CTXD = buffer[++addr];            //接收到ACK则继续读取数据
  64          //         }
  65          //     }
  66          //     else if (I2CSLST & 0x08)
  67          //     {
  68          //         I2CSLST &= ~0x08;                       //处理STOP事件
  69          //         isda = 1;
  70          //         isma = 1;
  71          //     }
  72          
  73          //     _pop_(P_SW2);
  74          // }
  75          
  76          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     56    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =    256    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
