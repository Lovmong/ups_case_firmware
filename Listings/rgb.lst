C51 COMPILER V9.60.7.0   RGB                                                               09/07/2023 16:22:41 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE RGB
OBJECT MODULE PLACED IN .\Objects\rgb.obj
COMPILER INVOKED BY: G:\Keil_v5_c51v961\C51\BIN\C51.EXE src\rgb.c OPTIMIZE(8,SPEED) INCDIR(.\src;.\system) PRINT(.\Listi
                    -ngs\rgb.lst) TABS(2) OBJECT(.\Objects\rgb.obj)

line level    source

   1          #include "rgb.h"
   2          
   3          /*---------------------------------------------------------------
   4              rgb: (PWMB)
   5                  LED_B -> PWM5 -> P2.0
   6                  LED_G -> PWM6 -> P2.1
   7                  LED_R -> PWM7 -> P2.2
   8          ---------------------------------------------------------------*/
   9          void rgbInit() {
  10   1      
  11   1          // P2M0 |= 0x07; P2M1 &= ~0x07; // ËÆæÁΩÆP2.0, P2.1, P2.2‰∏∫Êé®ÊåΩËæìÂá∫Ê®°Âºè
  12   1          P2M0 &= ~0x07; P2M1 &= ~0x07; // ËÆæÁΩÆP2.0, P2.1, P2.2‰∏∫ ÂáÜÂèåÂêëÂè£
  13   1      
  14   1      #if LED_USE_PWM
  15   1          // PWMB (PWM5, PWM6, PWM7,)
  16   1          P_SW2 |= 0x80;                              //‰ΩøËÉΩÊâ©Â±ïÂØÑÂ≠òÂô®(XFR)ËÆøÈóÆ
  17   1      
  18   1          // PWMB_PS = 0x00;                             // È´òÁ∫ß PWM ÈÄâÊã©ÂØÑÂ≠òÂô® PWMB_PS, ËÆæÁΩÆpwmËæìÂá∫Â
             -ºïËÑö
  19   1      
  20   1          PWMB_CCER1 = 0x00;                          //ÂÜôCCMRxÂâçÂøÖÈ°ªÂÖàÊ∏ÖÈõ∂CCERxÂÖ≥Èó≠ÈÄöÈÅì
  21   1      
  22   1          PWMB_CCMR1 = 0x68;                          //ËÆæÁΩÆ PWM5 ËæìÂá∫Ê®°Âºè 1, ‰ΩøËÉΩÈ¢ÑË£ÖËΩΩÂäüËÉΩ
  23   1          PWMB_CCMR2 = 0x68;                          //ËÆæÁΩÆ PWM6 ËæìÂá∫Ê®°Âºè 1, ‰ΩøËÉΩÈ¢ÑË£ÖËΩΩÂäüËÉΩ
  24   1          PWMB_CCMR3 = 0x68;                          //ËÆæÁΩÆ PWM7 ËæìÂá∫Ê®°Âºè 1, ‰ΩøËÉΩÈ¢ÑË£ÖËΩΩÂäüËÉΩ
  25   1          
  26   1          PWMB_CCER1 = 0x33;                          //‰ΩøËÉΩPWM5, PWM6ÈÄöÈÅì, ËÆæÁΩÆÊûÅÊÄß‰∏∫ ‰ΩéÁîµÂπ≥ÊúâÊïà
  27   1          PWMB_CCER2 = 0x03;                          //‰ΩøËÉΩPWM7ÈÄöÈÅì, ËÆæÁΩÆÊûÅÊÄß‰∏∫ ‰ΩéÁîµÂπ≥ÊúâÊïà
  28   1      
  29   1          PWMB_PSCRH = (u8)((_PWMB_PSCR-1) >> 8);     //ËÆæÁΩÆPWMBÈ¢ÑÂàÜÈ¢ë
  30   1          PWMB_PSCRL = (u8)(_PWMB_PSCR-1);
  31   1          PWMB_ARRH = (u8)((_PWMB_PERIOD-1) >> 8);    //ËÆæÁΩÆÂë®ÊúüÊó∂Èó¥Ôºå PWMB_ARRËá™Âä®ÈáçË£ÖÂÄº
  32   1          PWMB_ARRL = (u8)(_PWMB_PERIOD-1);
  33   1          
  34   1          PWMB_CCR5H  = (u8)(0 >> 8);                 //ËÆæÁΩÆPWM5ÂàùÂßãÂç†Á©∫ÊØî
  35   1          PWMB_CCR5L  = (u8)(0);
  36   1          PWMB_CCR6H = (u8)(0 >> 8);                  //ËÆæÁΩÆPWM6ÂàùÂßãÂç†Á©∫ÊØî
  37   1          PWMB_CCR6L = (u8)(0);
  38   1          PWMB_CCR7H = (u8)(0 >> 8);                  //ËÆæÁΩÆPWM7ÂàùÂßãÂç†Á©∫ÊØî
  39   1          PWMB_CCR7L = (u8)(0);
  40   1      
  41   1          PWMB_ENO |= 0x01;                           // ‰ΩøËÉΩ PWM5 ËæìÂá∫
  42   1          PWMB_ENO |= 0x04;                           // ‰ΩøËÉΩ PWM6 ËæìÂá∫
  43   1          PWMB_ENO |= 0x10;                           // ‰ΩøËÉΩ PWM ËæìÂá∫
  44   1      
  45   1          PWMB_BKR = 0x80;                            //‰ΩøËÉΩPWMB‰∏ªËæìÂá∫
  46   1          PWMB_CR1 = 0x01;                            //‰ΩøËÉΩPWMBËÆ°Êï∞Âô®ÔºåÂºÄÂßãËÆ°Êó∂, (00 ËæπÊ≤øÂØπÈΩêÊ®°Â
             -ºè)
  47   1      
  48   1      #endif
  49   1      }
  50          
  51          
  52          /* 
C51 COMPILER V9.60.7.0   RGB                                                               09/07/2023 16:22:41 PAGE 2   

  53          r, 0 ~ 255
  54          g, 0 ~ 255
  55          b, 0 ~ 255
  56          */
  57          void rgbWrite(u8 r, u8 g, u8 b) {
  58   1      #if LED_USE_PWM
  59   1          u16 ccr_r = 0;
  60   1          u16 ccr_g = 0;
  61   1          u16 ccr_b = 0;
  62   1      
  63   1          ccr_r = ((u32)_PWMB_PERIOD * r/255);
  64   1          ccr_g = ((u32)_PWMB_PERIOD * g/255);
  65   1          ccr_b = ((u32)_PWMB_PERIOD * b/255);
  66   1      
  67   1          P_SW2 |= 0x80;                                  //‰ΩøËÉΩÊâ©Â±ïÂØÑÂ≠òÂô®(XFR)ËÆøÈóÆ
  68   1          PWMB_CCR5H  = (u8)(ccr_b >> 8);                 //ËÆæÁΩÆPWM5Âç†Á©∫ÊØî
  69   1          PWMB_CCR5L  = (u8)(ccr_b);
  70   1          PWMB_CCR6H = (u8)(ccr_g >> 8);                  //ËÆæÁΩÆPWM6Âç†Á©∫ÊØî
  71   1          PWMB_CCR6L = (u8)(ccr_g);
  72   1          PWMB_CCR7H = (u8)(ccr_r >> 8);                  //ËÆæÁΩÆPWM7Âç†Á©∫ÊØî
  73   1          PWMB_CCR7L = (u8)(ccr_r);
  74   1      #else
                  if (r != 0) r = 1;
                  if (g != 0) g = 1;
                  if (b != 0) b = 1;
                  LED_R = r;
                  LED_G = g;
                  LED_B = b;
              #endif
  82   1      }
  83          
  84          void rgbClose() {
  85   1      #if LED_USE_PWM
  86   1          P_SW2 |= 0x80;                              //‰ΩøËÉΩÊâ©Â±ïÂØÑÂ≠òÂô®(XFR)ËÆøÈóÆ
  87   1          PWMB_CCR5H  = (u8)(0 >> 8);                 //ËÆæÁΩÆPWM5 Âç†Á©∫ÊØî ‰∏∫ 0
  88   1          PWMB_CCR5L  = (u8)(0);
  89   1          PWMB_CCR6H = (u8)(0 >> 8);                  //ËÆæÁΩÆPWM6 Âç†Á©∫ÊØî ‰∏∫ 0
  90   1          PWMB_CCR6L = (u8)(0);
  91   1          PWMB_CCR7H = (u8)(0 >> 8);                  //ËÆæÁΩÆPWM7 Âç†Á©∫ÊØî ‰∏∫ 0
  92   1          PWMB_CCR7L = (u8)(0);
  93   1      #else
                  LED_R = 0;
                  LED_G = 0;
                  LED_B = 0;
              #endif 
  98   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    222    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
